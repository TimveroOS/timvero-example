[[password-management]]
= Password Management

timveroOS provides built-in password security for the back-office user authentication system.
Configure account lockout, password expiration, and password validation rules through the `password.*` properties in your `application.properties` file.

== Account Lockout

The platform automatically locks a user account after too many consecutive failed login attempts.
Failed attempts are tracked within a rolling time window: attempts older than `password.block.minutes` are discarded before each check.

[source,properties]
----
# Maximum number of failed attempts within the window before the account is locked
password.attempts=3

# Number of minutes a failed attempt remains counted toward the lockout threshold
password.block.minutes=30
----

With the defaults above, a user who fails to log in 3 times within any 30-minute window is locked out.
The lock is automatically lifted once the oldest recorded attempt falls outside the window — no manual intervention is required.

TIP: Increase `password.attempts` or decrease `password.block.minutes` to reduce friction for legitimate users in high-traffic environments. For stricter security, do the opposite.

=== Remaining Attempts Feedback

The login failure response includes a remaining-attempts count, but only once the user is close to being locked out.
When the number of remaining attempts is 3 or fewer, the UI shows the exact count (e.g. "2 attempts remaining").
Before that threshold, a generic "bad credentials" message is shown instead.
Once the limit is reached, the account is locked and a dedicated locked-account message is displayed.

=== Admin Unlock

An administrator can manually unlock an account at any time.
Unlocking clears all recorded failed attempts for that user, restoring the full attempt allowance immediately without waiting for the time window to expire.

== Password Expiration

Passwords expire after a configurable number of days. The expiry is calculated from `passwordSetupAt` — the timestamp recorded each time a user sets a new password.
Once expired, the user is prompted to change their password on the next login.

[source,properties]
----
# Number of days before a password expires and must be changed
password.lifetime.days=90
----

NOTE: A password flagged as single-use (e.g. a temporary reset password) is treated as expired immediately, regardless of this setting.

== Password Change Flow

When a user's password has expired, the login page displays a change-password form.
Before the new password is saved, the following checks are applied in order:

. The new password and the confirmation field must match.
. The new password must differ from the current password submitted in the same form.
. The new password must satisfy the `password.pattern` regex.
. The new password must not match the password currently stored for the account.

If all checks pass, the password is encoded with BCrypt, `passwordSetupAt` is updated to the current timestamp, and the single-use flag is cleared.
The user is then redirected to the login page to authenticate with the new password.

== Temporary Passwords

The platform generates temporary passwords in two situations:

* **New user creation** — a 12-character random password is generated and assigned to the new account.
* **Admin password reset** — an administrator can reset any user's password, which generates a new 12-character temporary password.

In both cases the password is marked as single-use, which causes it to be treated as expired immediately (see <<Password Expiration>>).
The user is therefore required to change the password on their very first login.
A notification is sent automatically after each event — `UserCreatedEvent` for new accounts and `UserResetPasswordEvent` for admin resets.

== Configuration Reference

[cols="3,1,5"]
|===
|Property |Default |Description

|`password.attempts`
|`3`
|Maximum number of failed login attempts allowed within the window before the account is locked.

|`password.block.minutes`
|`30`
|Length of the rolling window (in minutes) used to count failed login attempts.

|`password.lifetime.days`
|`90`
|Number of days after which a password expires and must be changed.

|`password.pattern`
|`.*`
|Java regex pattern that a new password must match. Use `.*` to allow any value (no restriction).
|===
